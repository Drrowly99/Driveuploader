
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Signin</title>
    <link rel="stylesheet" href="../src/asset/css/output-v2.css"/>
    <link rel="stylesheet" href="../src/asset/css/default.css"/>
    <link rel="stylesheet" href="../src/asset/css/loading.css"/>
    <link rel="stylesheet" href="../src/asset/css/w3.css"/>
    <link rel= "manifest" href= "../manifest.json" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.13.0/css/all.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/js-cookie/3.0.5/js.cookie.min.js"></script>
    <script src="../src/asset/script/jquery-3.3.1.js"></script>
    <script src="../src/asset/script/include.js"></script>
    <script src="../src/asset/script/qrmin.js"></script>
    <script src="../src/asset/script/w3.js"></script>
    <script src="../src/asset/script/qrscript.js"></script>
    

</head>
<body>

<section id="airtime_recharge" class=" fixed top-0 left-0 right-0 h-screen backdrop-blur-sm max-w-[800px] ml-auto mr-auto w-full" style="display:none;background:rgba(29, 97, 210, 0.25); z-index:10;">
    <div class="max-w-[800px] w3-animate-zoom rounded-xl bg-white w-[90%] 4xtin:h-[500px] h-[520px] absolute top-0 right-0 left-0 bottom-0 m-auto">
        <div class="flex flex-row text-2xl pl-2 pr-2 bg-[#1D61D2] text-white h-[10vh] rounded-tl-xl rounded-tr-xl">
                <div onclick="w3.hide('#airtime_recharge'); AIR_emptyfield()" class=" font-bold quicksand w3-center text-xl flex-none ml-3 w-7 h-11 mt-4">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M10.5 19.5L3 12m0 0l7.5-7.5M3 12h18" />
                    </svg> 
                </div>
                <div class=" font-bold quicksand w3-center text-xl flex-1 mt-4">Airtime Recharge</div>    
                <div class=" font-bold quicksand w3-center text-xl flex-none  w-7 h-11 mt-4 invisible">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M10.5 19.5L3 12m0 0l7.5-7.5M3 12h18" />
                     </svg> 
                </div>
        </div>


        <div class="m-1 mt-4 flex justify-center items-start">
            <input id="AIR_Phone" type="tel" class="p-3 border w-[90%] rounded-md text-gray-600"  placeholder=" Phone Number" />
            <p class="AIR_err_phone text-red-500"></p>
        </div>

        <div class="m-1 mt-4 flex justify-center items-start">
            <input id="AIR_Amount" type="tel" class="p-3 border w-[90%] rounded-md text-gray-600 "  placeholder=" Amount" />
        </div>

        <div class="m-1 flex justify-center items-start">
            <i class="mt-2 flex text-sm items-start text-left w-[90%] pl-3 text-blue-600">You save ₦ <span class="yousave"></span> (3% off)</i>
        </div>
        <div class="ml-1 mr-1 flex justify-center items-start">
            <input id="AIR_Charge" type="tel" class="p-3 border w-[90%] rounded-md bg-slate-50 text-gray-600 " readonly  placeholder="We Charge you" />
        </div>

        <div class="m-1 mt-4 flex justify-center items-start">
            <input id="AIR_Network" type="tel" class="p-3 border w-[90%] rounded-md bg-slate-50 text-gray-600 " readonly  placeholder=" Network Provider" />
        </div>
        <div class="ml-1 mr-1 flex justify-start items-start">
            <span class="text-red-600 text-sm AIR_Error p-3 w-[90%] "></span>
        </div>


        <div class="m-1 mt-1 flex justify-center items-start">
            <button id="AIR_Send" onclick="AIR_Send()" class="p-3 rounded-lg w-[50%] bg-blue-300 text-white " style="outline: none;">
                <div class="AIR_Send_show text-lg" style="display: block;">Send</div>
                <div class="AIR_Load" style="display: none;">
                    <div class="spinner-border text-sm spinner-border-md " role="status">
                        <span class="sr-only " sty>Loading...</span>
                      </div>
                </div>
            </button>
        </div>
    </div>
</section>
</body>
</html>


<script>


$('#AIR_Send').prop('disabled', true);


function AIR_Provider(phone){
    
$('.AIR_Send_show').hide()
$('.AIR_Load').show()
$('#AIR_Send').prop('disabled', true);

let network = ''

let mtn = [ "0806","0803","0816","0813","0810","0814","0903","0906","0703","0706",];
let etisalat = ["0809", "0909", "0817", "0818", "0908"];
let glo = ["0805", "0705", "0905", "0807", "0815", "0811"];
let airtel = ["0802", "0902", "0701", "0808", "0708", "0812", "0907", "0904"];
let starcomms = ["07028", "07029", "0819"];
let visafone = ["07025", "07026", "0704"];
let multilinks = ["07027", "0709"];
let zoom = ["0707"];
let ntel = ["0804"];
let smile = ["0702"];

  if(mtn.includes(phone.substring(0,4))){
    network = 'mtn';
  }

  if(etisalat.includes(phone.substring(0,4))){
    network = 'etisalat';
  }

  if(glo.includes(phone.substring(0,4))){
    network = 'glo';
  }

  if(airtel.includes(phone.substring(0,4))){
    network = 'airtel';
  }

  if(starcomms.includes(phone.substring(0,5))){
    network = 'starcomms';
  }

  if(visafone.includes(phone.substring(0,5))){
    network = 'visafone';
  }

  if(smile.includes(phone.substring(0,4))){
    network = 'smile';
  }

  if(smile.includes(phone.substring(0,4))){
    network = 'smile';
  }

    console.log(network)
    $('#AIR_Network').val(network)
   



          $('#AIR_Send').prop('disabled', false);
          $('#AIR_Send').removeClass('bg-blue-300')
          $('#AIR_Send').addClass('bg-[#1D61D2]')
          $('.AIR_Send_show').show()
          $('.AIR_Load').hide()
         

        
          

}

function AIR_emptyfield(){
 
   $('#AIR_Phone').val('') 
   $('#AIR_Amount').val('') 
   $('#AIR_Network').val('') 
   $('#AIR_Charge').val('') 
}

function AIR_Send(e){
  let l_ = '<?php echo $_SESSION["U_TOKEN"]; ?>';
    e = e || window.event;
    e.preventDefault()

    let AIR_Phone = $('#AIR_Phone').val() 
    let AIR_Amount = $('#AIR_Amount').val() 
    let AIR_Network = $('#AIR_Network').val() 
    let AIR_Charge = $('#AIR_Charge').val() 

    if(AIR_Phone == '' || AIR_Amount == '' || AIR_Network == ''){
        return;
    }
    
    if(AIR_Network == 'None'){
        AIR_Network = 'airtel';
        // $('.AIR_Error').text('Error: phone number not identified')
        // console.log('error: phone number not identified');
        // return;
    }
    
    if(AIR_Amount < 50){
        $('.AIR_Error').text('Error: Minimum amount is NGN50')
        console.log('error: Minimum amount is NGN50');
        return;
    }




    $.ajax({
        url:  'https://api.dadicash.com/mob/bills/airtime',
        method: 'POST',
        data: {phone:AIR_Phone, amount:AIR_Amount, network:AIR_Network},
        dataType: 'json',
        beforeSend: function(xhr)
        {
            $('#load').show()
            $('#AIR_Send').prop('disabled', true);
            xhr.setRequestHeader('Authorization', 'Bearer '+l_)
        },
        error: function(err){
         $('#AIR_Send').prop('disabled', false);
         $('#load').hide()
       
        },
        success: function(data)
        {
          console.log(data)
         $('#load').hide()
         if(data.error == true){
        
             w3.hide('#airtime_recharge')
             AIR_emptyfield()
             $('#notification_pop').show()
                $('#general_error_airtime').show()
                $('.err_message_airtime').html(`<span>Your airtime top-up was unsuccessful</span>`)
                $('.err_title_airtime').html(`<span class="text-red-600">Airtime Error</span>`)
         } 
         if(data.success == true){
            AIR_emptyfield()
             $('#notification_pop').show()
                $('#general_error_airtime').show()
                $('.err_message_airtime').html(`<span class="quicksand">Your airtime top-up of ₦ ${AIR_Amount} was successful you saved 3%</span>`)
                $('.err_title_airtime').html(`<span class="text-green-600">Airtime Successful</span>`)
                 w3.hide('#airtime_recharge')
 
         }
          console.log(data)
          $('#AIR_Send').prop('disabled', false);
        }
    })
}
</script>
<script>
function amountMask() { 
   
    var am = $(this).val().replace(/[\D.-]/g,'');
    $(this).val(am)
    $('#AIR_Charge').val((am) - ((am*3)/100))
    let save = am - ((am) - ((am*3)/100))
    $('.yousave').text(save.toFixed(2))

}



  function phoneMask() { 
    $('#AIR_Send').prop('disabled', true);
    $('.AIR_err_phone').text('')
    $('.AIR_err_phone').hide()
    var nums = $(this).val().replace(/[\D.-]/g,'');
    $(this).val(nums)
    var num = $(this).val().replace(/[\D.-]/g,'');
    
    num_ =''
    num.trim()
    $('.show').text(num.length)
 
      
        if(num.substr(0, 4)== '+234'){
            num_ =  num.substring(4)
            $('.show').text(num_)
            $(this).val(num_)
         }
         if(num.substring(0, 3) == '234'){
            num_ = num.substring(3)
            $('.show').text(num_)
            $(this).val(num_)
         }
         if(num.substring(0, 2) == '+1'){
            num_ = num.substring(2)
            $('.show').text(num_)
            $(this).val(num_)
         }
         if(num.substring(0, 4) == '0234'){
          num_ = num.substring(3)
          $('.show').text(num_)
          $(this).val(num_)
       }
        
       
        
        

    if(num.length == 10){
      if(num.substring(0, 3) == '234'){
        num_ = num.substring(3)
        $('.show').text(num_)
        $(this).val(num_)
     }
      if(num.substring(0, 2) == '09' || num.substring(0, 2) == '08' || num.substring(0, 2) == '07' ){
       
       
    
    }else{
       
        $('.AIR_err_phone').text('Must start with 09 or 08 or 07')
        $('.AIR_err_phone').show()
        $(this).val('')
      }
        if(num.substring(0, 1) != '0' ){
            $(this).val('0'+num)
        }

       
}

if(num.length > 11){

  if(num.substring(0, 3) == '234'){
    num_ = num.substring(3)
    $(this).val('0'+num_)
  }else{
   $(this).val(num.substring(0, 11))
  }
}


if(num.length == 11){
    AIR_Provider( $(this).val());
}
}
$('#AIR_Phone').keyup(phoneMask);
$('#AIR_Amount').keyup(amountMask);
</script>
